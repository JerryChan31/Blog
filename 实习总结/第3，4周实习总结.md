# 第3，4周实习总结
12.10 - 12.21

最近公司的工作流程发生了一点变化，不再开大的需求会议了。产品产生的需求直接找组长确认可行性，确认后产品单独找开发进行需求评审和排期。排期安排写在看板上，整个团队的开发进展就一目了然了。

这两周的需求是短视频详情页新增了一个相关推荐栏和相关电影栏，同时因为同事请假，接过了同事手中的一些业务。这两周我们的新首页也上线了。

## 埋点
这两周处理得比较多的工作是上报埋点的问题。做得比较痛苦也比较烦人。

埋点是指当用户做出了某一些行为时，网页将用户的行为上报到后台记录下来。统计下来的数据可以反映用户的行为规律，从而提出产品改进意见。

目前在我们公司的工作流里面，开发的同时会有负责数据的同事编写埋点文档，功能开发接近完成时就会根据埋点文档将埋点加入代码中。

我们编写了一个util函数`stat()`，并且注入到项目里面，使得我们可以在需要的地方直接调用`this.$stat()`来上报信息。

埋点带来的一个问题是：一旦埋点被添加到组件里面，如果日后需要复用组件时，就会比较麻烦：同一个组件在不同的页面上报同样的数据。上报数据无法区分来源，数据的价值也就下降了。理论上的推荐做法是，组件内的埋点事件通过`emit`抛出，在`pages`页面里监听并处理上报。

但是这样也有一个问题：如果需要上报的数据包含A和B，A在组件中通过`emit()`的payload抛出，B是页面中的DOM信息（如点击区域），在这种情况下是没有办法同时上报二者的（或者说我没有想到方法）。因为在Vue中，目前是没有办法往payload中加数据的。因此，具体应该采取哪种办法，还是要视具体情况而定。

## 一个想法
埋点相关工作的另一个痛点是，有时候组件在不同的页面复用时，由于数据组的同事可能不清楚组件之前的埋点情况，导致重复编写埋点文档，或埋点前后不一致的情况。在编写埋点相关代码时，埋点文档也不是那么好查，有时候区域的命名变更但埋点文档没有更新，读起来就会比较累。

问题总结下来，就是目前的工作流在页面埋点命名————页面区域的对应关系上存在模糊。

我的一个想法是：将重构稿和埋点文档合并起来，做一个简单的插件，在点击重构稿时显示对应区域的埋点。这样就能将埋点名称和页面区域对应起来，清晰而又明确。

## GIT FLOW
这两周因为开始接触发版和hotfix，git也用得越来越熟练了，于是就在此记录一下git flow的一些概念，具体用法之后会在另一篇文章记录。这里是一份[gitflow备忘录](https://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html)，最常用的操作可以在这里查到。

git flow的目的是在开发过程中将不同feature的代码隔离，进行独立的开发和测试。它包含以下几个分支：
 - master分支：主分支，存放高质量的，通过测试的，可发到线上的代码。
 - develop分支：开发分支，存放高质量的，通过测试的代码。在发到线上之前，在develop分支上进行最后的整体的回归测试。
 - feature分支：功能分支，基于develop分支切出，不同的开发者在开发新功能时各自切出自己的feature分支，在上面进行独立的开发。
 - release分支：发布分支，基于develop分支切出，发版用。
 - hotfix分支：快速修复线上问题使用。

在写这篇文章的时候，发现一篇叫[Gitflow有害论](http://insights.thoughtworkers.org/gitflow-consider-harmful/)的文章。里面的核心观点是：**gitflow的分支模式使得代码延迟合并，最终导致痛苦的合并冲突**。这的确是gitflow的一个缺点。但放在我们团队的工作流里，这不是一个特别大的问题，原因如下：

1. 我们团队的开发周期一般比发布周期短。这使得在代码合并到develop分支时不会有特别大的冲突。
2. 团队内开发功能相对独立。不同人员同时开发的模块一般不会重合。
3. 如果遇到需要多人同时开发相同模块的情况，团队成员会在同一个分支上进行开发。

这样看下来，上面这篇文章提到的缺点基本上都被回避掉了。 
